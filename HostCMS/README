Модуль разработан в компании GateOn предназначен для Host CMS v.6
Сайт разработчикa: www.gateon.net
E-mail: www@smartbyte.pro



Установка модуля:
1) В панели администратора откройте вкладку Контент -> Интернет магазины -> "Название вашего магазина" -> вкладка "Справочники"->  Платежные системы -> сверху вкладка "Платежные системы" -> Добавить

	Название: "Интеркасса"
	Описание: 
	"Система приёма платежей Интеркасса предоставляет возможность для Ваших интернет-проектов принимать оплату более чем 50-ю популярными платёжными системы ( Visa/Mastercard, WebMoney, Privat24, 	Единый кошелек, Perfect Money, Яндекс.Деньги, Payeer, Qiwi Кошелек, и т.д. ) через единый шлюз"

	Поставьте галочку активность

	Примените изменения

2) В списке модулей зайдите на только что созданный модуль Интеркассы

	В поле обработчик вставьте все содержимое файла "код модуля"

	Перейдите в "Дополнительные" и скопируйте число "Идентификатор"

	В обработчике сверху в строке есть следующая строка

	class Shop_Payment_System_HandlerXX extends Shop_Payment_System_Handler
	{

	Измените ХХ на скопированный идентификатор
	Например: для индентификатора 74 получится:
	class Shop_Payment_System_Handler74 extends Shop_Payment_System_Handler
	{

	Опуститесь ниже там есть четыре главных параметра:
	protected $_ik_co_id
	protected $_ik_secret_key
	protected $_ik_test_key
	protected $_interkassa_currency

	Заполните их в соответствии с указаниями.

3) В панели администратора зайдите в Структура сайта -> Типовые динамические страницы -> Интернет магазин ->Интернет-магазин корзина(справа значек карандаша для редактирования)
Во вкладке "Настройки страницы" после строки:

	$oShop = Core_Entity::factory('Shop', Core_Array::get(Core_Page::instance()->libParams, 'shopId'));

	добавим следующий код обработчик (при условии если его там нет)

	// ------------------------------------------------
	// Обработка уведомления об оплате от Interkassa
	// ------------------------------------------------
	if (isset($_REQUEST['ik_sign']))
	{
	
	   // Получаем ID заказа
	   $order_id = intval(Core_Array::getRequest('ik_pm_no'));
	
	   $oShop_Order = Core_Entity::factory('Shop_Order')->find($order_id);

	   if (!is_null($oShop_Order->id))
	   {
	      // Вызов обработчика платежной системы
	      Shop_Payment_System_Handler::factory($oShop_Order->Shop_Payment_System)
		 ->shopOrder($oShop_Order)
		 ->paymentProcessing();
	   }
	}


	Во вкладке "Код страницы" на этой же странице находятся 

	// ------------------------------------------------
	// Вывод информации о статусе платежа после его совершения и перенаправления с платежной системы
	// ------------------------------------------------
	if (isset($_REQUEST['payment'])
			|| isset($_GET['action']) && ($_GET['action'] == 'PaymentSuccess' || $_GET['action'] == 'PaymentFail')
			|| isset($_REQUEST['pg_order_id'])
	)
	{
	// Получаем ID заказа
	if (isset($_REQUEST['order_id']))
	{
		$order_id = intval(Core_Array::getRequest('order_id'));
	}

	после этого кода добавьте следующее условие

	elseif(isset($_REQUEST['ik_pm_no'])){

	   $order_id = intval(Core_Array::getRequest('ik_pm_no'));
	  
	}	

4) Еще раз проверьте правильно ли вы ввели все параметры и взяли нужную валюту


